{"version":3,"sources":["webpack:///../src/common.ts","webpack:///../src/event-listeners.ts","webpack:///../src/event.ts","webpack:///../src/fetch.ts","webpack:///../src/history.ts","webpack:///../src/index.ts","webpack:///../src/rewrite-urls.ts","webpack:///../src/script.ts","webpack:///../src/scroll.ts","webpack:///../src/update.ts"],"names":["Cause","isExternal","url","location","arguments","length","undefined","window","protocol","host","isHash","_ref","hash","origin","pathname","shouldLoadAnchor","anchor","target","isPushEvent","_ref2","event","metaKey","ctrlKey","isHintEvent","_ref3","isHashChange","_ref4","cause","oldURL","Pop","Push","flat","x","Array","prototype","concat","apply","combineRecords","records","addedNodes","Set","map","r","from","removedNodes","EventListenersMixin","setupEventListeners","pushEvent$","fromEvent","el","pipe","matchesAncestors","linkSelector","HTMLAnchorElement","filter","matchOrQuery","selector","matches","of","querySelectorAll","addEventListeners","link","merge","passive","hintEvent$","$","switchMap","links","Map","addLink","has","set","removeLink","delete","createMutationObservable","childList","subtree","startWith","bufferDebounceTime","Element","mergeMap","tap","subscribe","values","mergeAll","subscribeWhen","prefetch","timeout","t","Promise","setTimeout","EventManager","constructor","parent","onStart","context","animPromise","duration","transitionUntil","promise","all","fireEvent","detail","_objectSpread","emitDOMError","error","process","console","href","history","back","document","assign","emitNetworkError","emitError","emitReady","emitAfter","fadePromise","emitProgress","emitLoad","FetchManager","fetchPage","fetchRx","method","mode","headers","Accept","response","text","responseText","catchError","selectPrefetch","latestPrefetch","prefetch$","take","getResponse","zip","HashChangeEvent","type","newURL","e","CustomEvent","simHashChange","dispatchEvent","HistoryManager","updateHistoryScrollPosition","state","assignScrollPosition","replaceState","title","updateHistoryState","replace","Init","histId","pushState","simulateHashChange","updateTitle","scrollTop","getScrollTop","scrollHeight","getScrollHeight","compareContext","p","q","cacheNr","HyPushState","applyMixins","RxLitElement","baseURL","_HyPushState_initialized","createResolvablePromise","resolve","_HyPushState_scrollManager","ScrollManager","_HyPushState_historyManager","_HyPushState_fetchManager","_HyPushState_updateManager","UpdateManager","_HyPushState_eventManager","_HyPushState_url","URL","_HyPushState_setLocation","key","value","u","__classPrivateFieldGet","_HyPushState_cacheNr","_HyPushState_reload$","Subject","_HyPushState_updateHistoryScrollPosition","_HyPushState_response$","_HyPushState_upgrade","push$","preventDefault","pop$","reload$","merged$","pairwise","old","current","Object","share","page$","hash$","observeOn","animationFrameScheduler","manageScrollPosition","pauser$","defer","mapTo","hint$","filterWhen","Hint","prefetchResponse$","distinctUntilChanged","y","response$","__classPrivateFieldSet","withLatestFrom","args","responseOk$","ctx","responseErr$","main$","responseToContent","updateDOM","scripts","_","c","then","reinsertScriptTags","error$","progress$","takeUntil","createRenderRoot","initialized","hostname","port","search","ancestorOrigins","call","id","tagName","next","_a","reload","connectedCallback","BehaviorSubject","addEventListener","documentElement","updateComplete","disconnectedCallback","removeEventListener","__decorate","property","String","reflect","attribute","Boolean","Number","customElement","rewriteURLs","replaceEls","base","forEach","rewriteURL","rewriteURLSrcSet","rewriteURLList","attr","attrVal","getAttribute","setAttribute","split","str","pair","join","cloneScript","script","newScript","createElement","attributes","setAttributeNode","cloneNode","innerHTML","ScriptManager","scriptSelector","removeScriptTags","HTMLScriptElement","push","originalWrite","write","concatMap","insertScript","finalize","toPromise","ref","temp","_len","_key","childNodes","node","parentNode","insertBefore","reject","src","replaceChild","_b","scrollRestoration","scrollHashIntoView","behavior","block","inline","restoreScrollPosition","restoreScrollPositionOnReload","elementFromHash","getElementById","decodeURIComponent","substr","options","scrollIntoView","scroll","pageXOffset","scrollState","requestAnimationFrame","CANONICAL_SEL","META_DESC_SEL","scriptManager","replaceSelector","getReplaceElements","doc","sel","querySelector","index","getElementsByTagName","indexOf","DOMParser","parseFromString","every","Error","replaceContentWithSelector","elements","oldElement","i","replaceContentWholesale","replaceContent","replaceHead","head","ownerDocument","canonicalEl","cEl","metaDescEl","mEl","content"],"mappings":"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","file":"vendors~push-state-hydejack-9.2.1.js","sourcesContent":["export {\n  applyMixins,\n  subscribeWhen,\n  unsubscribeWhen,\n  filterWhen,\n  bufferDebounceTime,\n  fetchRx,\n  fragmentFromString,\n  createMutationObservable,\n  getScrollHeight,\n  getScrollLeft,\n  getScrollTop,\n  matches,\n  matchesAncestors\n} from '@hydecorp/component';\n\nexport enum Cause {\n  Init = \"init\",\n  Hint = \"hint\",\n  Push = \"push\",\n  Pop = \"pop\",\n};\n\nexport interface Context {\n  cause: Cause,\n  url: URL,\n  oldURL?: URL,\n  cacheNr?: number,\n  replace?: boolean,\n  error?: any,\n  anchor?: HTMLAnchorElement,\n}\n\nexport interface ClickContext extends Context {\n  event: MouseEvent,\n}\n\nexport function isExternal(\n  url?: { protocol: string, host: string } | null,\n  location: { protocol: string, host: string } = window.location,\n) {\n  return url != null && (url.protocol !== location.protocol || url.host !== location.host);\n}\n\nexport function isHash(\n  { hash, origin, pathname }: { hash: string, origin: string, pathname: string },\n  location: { hash: string, origin: string, pathname: string } = window.location,\n) {\n  return hash !== \"\" && origin === location.origin && pathname === location.pathname;\n}\n\nexport function shouldLoadAnchor(anchor?: HTMLAnchorElement | null) {\n  return anchor && anchor.target === \"\";\n}\n\nexport function isPushEvent({ url, anchor, event: { metaKey, ctrlKey } }: ClickContext, location: Location) {\n  return !!(\n    !metaKey &&\n    !ctrlKey &&\n    shouldLoadAnchor(anchor) &&\n    !isExternal(url, location)\n  );\n}\n\nexport function isHintEvent({ url, anchor }: Context, location: Location) {\n  return !!(\n    shouldLoadAnchor(anchor) &&\n    !isExternal(url, location) &&\n    !isHash(url, location)\n  );\n}\n\nexport function isHashChange({\n  cause,\n  url: { pathname, hash },\n  oldURL,\n}: Context) {\n  return pathname === oldURL?.pathname && (cause === Cause.Pop || (cause === Cause.Push && hash !== ''));\n}\n","import { Subject, Observable, from, fromEvent, of, merge, NEVER } from \"rxjs\";\n\nimport { matchesAncestors, createMutationObservable, subscribeWhen, bufferDebounceTime } from \"./common\";\nimport { map, filter, startWith, tap, mergeMap, mergeAll, switchMap } from \"rxjs/operators\";\n\nconst flat = <T>(x: Array<Array<T>>): Array<T> => Array.prototype.concat.apply([], x);\n\ntype MiniRecord = { addedNodes: Iterable<Node>, removedNodes: Iterable<Node> };\n\nconst combineRecords = (records: MiniRecord[]) => ({\n  addedNodes: new Set(flat(records.map(r => Array.from(r.addedNodes)))),\n  removedNodes: new Set(flat(records.map(r => Array.from(r.removedNodes)))),\n});\n\nexport class EventListenersMixin {\n  el!: HTMLElement;\n\n  linkSelector!: string;\n\n  $!: {\n    linkSelector: Subject<string>;\n    prefetch: Subject<boolean>;\n  }\n\n  // LINKS 2\n  setupEventListeners() {\n    const pushEvent$ = fromEvent(this.el, \"click\").pipe(\n      map(event => {\n        const anchor = matchesAncestors(<Element>event.target, this.linkSelector);\n        if (anchor instanceof HTMLAnchorElement) {\n          return [event, anchor] as [MouseEvent, HTMLAnchorElement];\n        }\n      }),\n      filter(x => !!x),\n    );\n\n    const matchOrQuery = (el: Element, selector: string): Observable<HTMLAnchorElement> => {\n      if (el.matches(selector) && el instanceof HTMLAnchorElement) {\n        return of(el);\n      } else {\n        return from(el.querySelectorAll(selector)).pipe(\n          filter((el): el is HTMLAnchorElement => el instanceof HTMLAnchorElement),\n        );\n      }\n    }\n\n    const addEventListeners = (link: HTMLAnchorElement) => {\n      return merge(\n        fromEvent(link, \"mouseenter\", { passive: true }),\n        fromEvent(link, \"touchstart\", { passive: true }),\n        fromEvent(link, \"focus\", { passive: true }),\n      ).pipe(map(event => [event, link] as [Event, HTMLAnchorElement]))\n    };\n\n    const hintEvent$ = this.$.linkSelector.pipe(switchMap((linkSelector) => {\n      const links = new Map<HTMLAnchorElement, Observable<[Event, HTMLAnchorElement]>>();\n\n      const addLink = (link: HTMLAnchorElement) => {\n        if (!links.has(link)) {\n          links.set(link, addEventListeners(link));\n        }\n      }\n      const removeLink = (link: HTMLAnchorElement) => {\n        links.delete(link);\n      }\n\n\n      return createMutationObservable(this.el, { childList: true, subtree: true }).pipe(\n        startWith({ addedNodes: [this.el], removedNodes: [] }),\n        bufferDebounceTime(500),\n        map(combineRecords),\n        switchMap(({ addedNodes, removedNodes }) => {\n          from(removedNodes).pipe(\n            filter((el): el is Element => el instanceof Element),\n            mergeMap(el => matchOrQuery(el, linkSelector)),\n            tap(removeLink)\n          ).subscribe()\n\n          from(addedNodes).pipe(\n            filter((el): el is Element => el instanceof Element),\n            mergeMap(el => matchOrQuery(el, linkSelector)),\n            tap(addLink)\n          ).subscribe()\n\n          return from(links.values()).pipe(mergeAll());\n        }),\n        subscribeWhen(this.$.prefetch),\n      );\n    }));\n\n    return { hintEvent$, pushEvent$ }\n  }\n}\n","import { Context } from './common';\nimport { ResponseContextErr } from './fetch';\nimport { HyPushState } from \"./index\";\n\nconst timeout = (t: number) => new Promise(r => setTimeout(r, t));\n\nexport class EventManager {\n  private parent: HyPushState;\n\n  constructor(parent: HyPushState) {\n    this.parent = parent;\n  }\n\n  onStart(context: Context) {\n    this.parent.animPromise = timeout(this.parent.duration);\n\n    const transitionUntil = (promise: Promise<{}>) => {\n      this.parent.animPromise = Promise.all([this.parent.animPromise, promise]);\n    };\n\n    this.parent.fireEvent('start', { detail: { ...context, transitionUntil } });\n  }\n\n  emitDOMError(error: any) {\n    if (process.env.DEBUG) console.error(error);\n\n    // To open the link directly, we first pop one entry off the browser history.\n    // We have to do this because some browsers (Safari) won't handle the back button correctly otherwise.\n    // We then wait for a short time and change the document's location.\n    // TODO: If we didn't call `pushState` optimistically we wouldn't have to do this.\n    // TODO: Use browser sniffing instead?\n    const url = location.href;\n    window.history.back();\n    setTimeout(() => document.location.assign(url), 100);\n  }\n\n  emitNetworkError(context: ResponseContextErr) {\n    if (process.env.DEBUG) console.error(context);\n    this.parent.fireEvent('networkerror', { detail: context });\n  }\n\n  emitError(context: Context) {\n    if (process.env.DEBUG) console.error(context);\n    this.parent.fireEvent('error', { detail: context });\n  }\n\n  emitReady(context: Context) {\n    this.parent.fireEvent('ready', { detail: context });\n  }\n\n  emitAfter(context: Context) {\n    this.parent.fadePromise = timeout(this.parent.duration);\n\n    const transitionUntil = (promise: Promise<{}>) => {\n      this.parent.fadePromise = Promise.all([this.parent.fadePromise, promise]);\n    };\n\n    this.parent.fireEvent('after', { detail: { ...context, transitionUntil } });\n  }\n\n  emitProgress(context: Context) {\n    this.parent.fireEvent('progress', { detail: context });\n  }\n\n  emitLoad(context: Context) {\n    this.parent.fireEvent('load', { detail: context });\n  }\n};","import { of, zip, Observable } from \"rxjs\";\nimport { catchError, map, take, switchMap } from \"rxjs/operators\";\n\nimport { fetchRx, Context } from \"./common\";\nimport { HyPushState } from './index';\n\nexport interface ResponseContext extends Context {\n  responseText: string | null;\n  error?: any;\n};\n\nexport interface ResponseContextOk extends ResponseContext {\n  responseText: string;\n};\n\nexport interface ResponseContextErr extends ResponseContext {\n  responseText: null;\n  error: any;\n};\n\nexport class FetchManager {\n  private parent: HyPushState;\n\n  constructor(parent: HyPushState) {\n    this.parent = parent;\n  }\n\n  fetchPage(context: Context): Observable<ResponseContext> {\n    return fetchRx(context.url.href, {\n      method: \"GET\",\n      mode: 'cors', ///isExternal(this.parent) ? 'cors' : undefined,\n      headers: { Accept: \"text/html\" },\n    })\n    .pipe(\n      switchMap(response => response.text()),\n      map(responseText => ({ ...context, responseText })),\n      catchError(error => of({ ...context, error, responseText: null })),\n    );\n  }\n\n  private selectPrefetch({ href }: URL, latestPrefetch: ResponseContext, prefetch$: Observable<ResponseContext>) {\n    return href === latestPrefetch.url.href // && latestPrefetch.error == null\n      ? of(latestPrefetch)\n      : prefetch$.pipe(take(1));\n  }\n\n  // Returns an observable that emits exactly one notice, which contains the response.\n  // It will not emit until an (optional) page transition animation completes.\n  getResponse(prefetch$: Observable<ResponseContext>, context: Context, latestPrefetch: ResponseContext) {\n    return zip(\n      this.selectPrefetch(context.url, latestPrefetch, prefetch$),\n      this.parent.animPromise,\n    ).pipe(\n      map(([prefetch]) => ({ ...prefetch, ...context }) as ResponseContext),\n    );\n  }\n};\n","import { isExternal, getScrollTop, getScrollHeight, Cause, Context } from \"./common\";\n\nimport { ReplaceContext } from \"./update\";\n\n// @ts-ignore\nwindow.HashChangeEvent = window.HashChangeEvent || function HashChangeEvent(type, { oldURL = '', newURL = '' } = {}) {\n  const e = new CustomEvent(type)\n  // @ts-ignore\n  e.oldURL = oldURL;\n  // @ts-ignore\n  e.newURL = newURL;\n  return e;\n}\n\nfunction simHashChange(newURL: URL, oldURL: URL) {\n  if (newURL.hash !== oldURL.hash) {\n    window.dispatchEvent(new HashChangeEvent('hashchange', { newURL: newURL.href, oldURL: oldURL.href }));\n  }\n}\n\nexport class HistoryManager {\n  private parent: Location & { histId: string, simulateHashChange: boolean };\n\n  constructor(parent: Location & { histId: string, simulateHashChange: boolean }) {\n    this.parent = parent;\n  }\n\n  updateHistoryState({ cause, replace, url, oldURL }: Context) {\n    if (isExternal(this.parent)) return;\n\n    switch (cause) {\n      case Cause.Init:\n      case Cause.Push: {\n        const { histId } = this.parent;\n\n        if (replace || url.href === location.href) {\n          const state = { ...history.state, [histId]: {} };\n          history.replaceState(state, document.title, url.href);\n        } else {\n          history.pushState({ [histId]: {} }, document.title, url.href);\n        }\n        // no break\n      }\n      case Cause.Pop: {\n        if (this.parent.simulateHashChange && oldURL) simHashChange(url, oldURL);\n        break;\n      }\n      default: {\n        // if (process.env.DEBUG) console.warn(`Type '${cause}' not reconginzed`);\n        break;\n      }\n    }\n  }\n\n  updateTitle({ cause, title }: ReplaceContext) {\n    document.title = title;\n    if (!isExternal(this.parent) && cause === Cause.Push) {\n      history.replaceState(history.state, title);\n    }\n  }\n\n  updateHistoryScrollPosition = () => {\n    if (isExternal(this.parent)) return;\n\n    const state = this.assignScrollPosition(history.state || {});\n    history.replaceState(state, document.title);\n  }\n\n  private assignScrollPosition(state: any) {\n    const { histId } = this.parent;\n    return {\n      ...state,\n      [histId]: {\n        ...state[histId],\n        scrollTop: getScrollTop(),\n        scrollHeight: getScrollHeight(),\n      },\n    };\n  }\n};\n","/** \n * Copyright (c) 2020 Florian Klampfer <https://qwtel.com/>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n * \n * @license \n * @nocompile\n */\nimport { property, customElement } from 'lit-element';\n\nimport { Observable, Subject, BehaviorSubject, merge, defer, fromEvent, animationFrameScheduler } from \"rxjs\";\nimport { map, filter, tap, takeUntil, startWith, pairwise, share, mapTo, switchMap, distinctUntilChanged, withLatestFrom, catchError, observeOn } from 'rxjs/operators';\n\nimport { RxLitElement, createResolvablePromise, matchesAncestors } from '@hydecorp/component';\n\nimport { applyMixins, Context, Cause, ClickContext, isPushEvent, isHashChange, isHintEvent, filterWhen, isExternal } from './common';\n\nimport { FetchManager, ResponseContext, ResponseContextErr, ResponseContextOk } from './fetch';\nimport { UpdateManager } from './update';\nimport { EventListenersMixin } from './event-listeners';\nimport { EventManager } from './event';\nimport { HistoryManager } from './history';\nimport { ScrollManager } from './scroll';\n\nfunction compareContext(p: Context, q: Context) {\n  return p.url.href === q.url.href && p.error === q.error && p.cacheNr === q.cacheNr;\n}\n\n@customElement('hy-push-state')\nexport class HyPushState\n  extends applyMixins(RxLitElement, [EventListenersMixin])\n  implements Location, EventListenersMixin {\n\n  el: HTMLElement = this\n\n  createRenderRoot() { return this }\n\n  @property({ type: String, reflect: true, attribute: 'replace-selector' }) replaceSelector?: string;\n  @property({ type: String, reflect: true, attribute: 'link-selector' }) linkSelector: string = \"a[href]:not([data-no-push])\";\n  @property({ type: String, reflect: true, attribute: 'script-selector' }) scriptSelector?: string;\n  @property({ type: Boolean, reflect: true }) prefetch: boolean = false;\n  @property({ type: Number, reflect: true }) duration: number = 0;\n  // @property({ type: Boolean, reflect: true, attribute: 'simulate-load' }) simulateLoad: boolean = false;\n  @property({ type: Boolean, reflect: true, attribute: 'hashchange' }) simulateHashChange: boolean = false;\n\n  @property({ type: String }) baseURL: string = window.location.href;\n\n  #initialized = createResolvablePromise();\n  get initialized() {\n    return this.#initialized;\n  }\n\n  $!: {\n    linkSelector: Subject<string>;\n    prefetch: Subject<boolean>;\n  };\n\n  animPromise: Promise<any> = Promise.resolve(null);\n  fadePromise: Promise<any> = Promise.resolve(null);\n\n  #scrollManager = new ScrollManager(this);\n  #historyManager = new HistoryManager(this);\n  #fetchManager = new FetchManager(this);\n  #updateManager = new UpdateManager(this);\n  #eventManager = new EventManager(this);\n\n  #url = new URL(this.baseURL)\n\n  #setLocation = (key: 'hash' | 'host' | 'hostname' | 'href' | 'pathname' | 'port' | 'protocol' | 'search', value: string) => {\n    const u = new URL(this.#url.href);\n    u[key] = value;\n    this.assign(u.href);\n  }\n\n  // Implement Location\n  get hash() { return this.#url.hash }\n  get host() { return this.#url.host }\n  get hostname() { return this.#url.hostname }\n  get href() { return this.#url.href }\n  get pathname() { return this.#url.pathname }\n  get port() { return this.#url.port }\n  get protocol() { return this.#url.protocol }\n  get search() { return this.#url.search }\n  get origin() { return this.#url.origin }\n  get ancestorOrigins() { return window.location.ancestorOrigins }\n\n  set hash(value) { this.#setLocation('hash', value) }\n  set host(value) { this.#setLocation('host', value) }\n  set hostname(value) { this.#setLocation('hostname', value) }\n  set href(value) { this.#setLocation('href', value) }\n  set pathname(value) { this.#setLocation('pathname', value) }\n  set port(value) { this.#setLocation('port', value) }\n  set protocol(value) { this.#setLocation('protocol', value) }\n  set search(value) { this.#setLocation('search', value) }\n\n  // EventListenersMixin\n  setupEventListeners!: () => {\n    pushEvent$: Observable<[MouseEvent, HTMLAnchorElement]>;\n    hintEvent$: Observable<[Event, HTMLAnchorElement]>;\n  };\n\n  #cacheNr = 0;\n\n  get histId() { return this.id || this.tagName }\n\n  #reload$ = new Subject<Context>();\n\n  @property()\n  assign(url: string) {\n    this.#reload$.next({\n      cause: Cause.Push,\n      url: new URL(url, this.href),\n      cacheNr: ++this.#cacheNr,\n    });\n  }\n\n  @property()\n  reload() {\n    this.#reload$.next({\n      cause: Cause.Push,\n      url: new URL(this.href),\n      cacheNr: ++this.#cacheNr,\n      replace: true,\n    });\n  }\n\n  @property()\n  replace(url: string) {\n    this.#reload$.next({\n      cause: Cause.Push,\n      url: new URL(url, this.href),\n      cacheNr: ++this.#cacheNr,\n      replace: true,\n    });\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n\n    this.$ = {\n      linkSelector: new BehaviorSubject(this.linkSelector),\n      prefetch: new BehaviorSubject(this.prefetch),\n    };\n\n    // Remember the current scroll position (for F5/reloads).\n    window.addEventListener(\"beforeunload\", this.#historyManager.updateHistoryScrollPosition);\n\n    // Remember scroll position for backward/forward navigation cache.\n    // Technically, this is only necessary for Safari, because other browsers will not use the BFN cache\n    // when a beforeunload event is registered...\n    document.documentElement.addEventListener('click', this.#updateHistoryScrollPosition)\n\n    this.updateComplete.then(this.#upgrade)\n  }\n\n  #updateHistoryScrollPosition = (event: MouseEvent) => {\n    const anchor = matchesAncestors(event.target as Element, 'a[href]') as HTMLAnchorElement | null;\n    if (isExternal(anchor)) {\n      this.#historyManager.updateHistoryScrollPosition();\n    }\n  }\n\n  #response$!: Observable<ResponseContext>\n\n  #upgrade = () => {\n    const { pushEvent$, hintEvent$ } = this.setupEventListeners();\n\n    const push$: Observable<ClickContext> = pushEvent$.pipe(\n      // takeUntil(this.subjects.disconnect),\n      map(([event, anchor]) => ({\n        cause: Cause.Push,\n        url: new URL(anchor.href, this.href),\n        anchor,\n        event,\n        cacheNr: this.#cacheNr,\n      })),\n      filter(x => isPushEvent(x, this)),\n      tap(({ event }) => {\n        event.preventDefault();\n        this.#historyManager.updateHistoryScrollPosition();\n      })\n    );\n\n    const pop$: Observable<Context> = fromEvent(window, \"popstate\").pipe(\n      // takeUntil(this.subjects.disconnect),\n      filter(() => window.history.state && window.history.state[this.histId]),\n      map(event => ({\n        cause: Cause.Pop,\n        url: new URL(window.location.href),\n        cacheNr: this.#cacheNr,\n        event,\n      }))\n    );\n\n    const reload$ = this.#reload$; // .pipe(takeUntil(this.subjects.disconnect));\n\n    const merged$: Observable<Context> = merge(push$, pop$, reload$).pipe(\n      startWith({ url: new URL(window.location.href) } as Context),\n      pairwise(),\n      map(([old, current]) => Object.assign(current, { oldURL: old.url })),\n      share(),\n    );\n\n    const page$ = merged$.pipe(\n      filter(p => !isHashChange(p)),\n      share(),\n    );\n\n    const hash$ = merged$.pipe(\n      filter(p => isHashChange(p)),\n      filter(() => history.state && history.state[this.histId]),\n      observeOn<Context>(animationFrameScheduler),\n      tap(context => {\n        this.#historyManager.updateHistoryState(context);\n        this.#scrollManager.manageScrollPosition(context);\n      }),\n    );\n\n    const pauser$ = defer(() => merge(\n      page$.pipe(mapTo(true)),\n      this.#response$.pipe(mapTo(false)),\n    )).pipe(\n      startWith(false),\n    );\n\n    const hint$: Observable<Context> = hintEvent$.pipe(\n      // takeUntil(this.subjects.disconnect),\n      filterWhen(pauser$.pipe(map(x => !x))),\n      map(([event, anchor]) => ({\n        cause: Cause.Hint,\n        url: new URL(anchor.href, this.href),\n        anchor,\n        event,\n        cacheNr: this.#cacheNr,\n      })),\n      filter(x => isHintEvent(x, this)),\n    );\n\n    const prefetchResponse$ = merge(hint$, page$).pipe(\n      distinctUntilChanged((x, y) => compareContext(x, y)),\n      switchMap(x => this.#fetchManager.fetchPage(x)),\n      startWith({ url: {} } as ResponseContext),\n      share(),\n    );\n\n    const response$ = this.#response$ = page$.pipe(\n      tap(context => {\n        this.#eventManager.onStart(context)\n        this.#historyManager.updateHistoryState(context);\n        this.#url = context.url;\n      }),\n      withLatestFrom(prefetchResponse$),\n      switchMap((args) => this.#fetchManager.getResponse(prefetchResponse$, ...args)),\n      share(),\n    );\n\n    const responseOk$ = response$.pipe(filter((ctx): ctx is ResponseContextOk => !ctx.error));\n    const responseErr$ = response$.pipe(filter((ctx): ctx is ResponseContextErr => !!ctx.error));\n\n    const main$ = responseOk$.pipe(\n      map(context => this.#updateManager.responseToContent(context)),\n      tap(context => this.#eventManager.emitReady(context)),\n      observeOn(animationFrameScheduler),\n      tap(context => {\n        this.#updateManager.updateDOM(context);\n        this.#historyManager.updateTitle(context)\n        this.#eventManager.emitAfter(context);\n      }),\n      startWith({\n        cause: Cause.Init,\n        url: this.#url,\n        scripts: [],\n      }),\n      observeOn(animationFrameScheduler),\n      tap(context => this.#scrollManager.manageScrollPosition(context)),\n      tap({ error: (e) => this.#eventManager.emitDOMError(e) }),\n      catchError((_, c) => c),\n      switchMap((x) => this.fadePromise.then(() => x)),\n      switchMap(x => this.#updateManager.reinsertScriptTags(x)),\n      tap({ error: e => this.#eventManager.emitError(e) }),\n      catchError((_, c) => c),\n      tap(context => this.#eventManager.emitLoad(context)),\n    );\n\n    const error$ = responseErr$.pipe(\n      tap(e => this.#eventManager.emitNetworkError(e)),\n    );\n\n    const progress$ = page$.pipe(\n      switchMap(context =>\n        defer(() => this.animPromise).pipe(\n          takeUntil(response$),\n          mapTo(context),\n        ),\n      ),\n      tap(context => this.#eventManager.emitProgress(context)),\n    );\n\n    // Subscriptions\n    main$.subscribe();\n    hash$.subscribe();\n    error$.subscribe();\n    progress$.subscribe();\n\n    this.#initialized.resolve(this);\n    this.fireEvent('init');\n  }\n\n  disconnectedCallback() {\n    window.removeEventListener(\"beforeunload\", this.#historyManager.updateHistoryScrollPosition);\n    document.documentElement.removeEventListener('click', this.#updateHistoryScrollPosition);\n  }\n}\n","// When fetching documents from an external source,\n// relative URLs will be resolved relative to the current `window.location`.\n// We can rewrite URL to absolute urls\nexport function rewriteURLs(replaceEls: (Element | null)[], base: string) {\n  replaceEls.forEach((el) => {\n    if (!el) return;\n    el.querySelectorAll(\"[href]\").forEach(rewriteURL(\"href\", base));\n    el.querySelectorAll(\"[src]\").forEach(rewriteURL(\"src\", base));\n    el.querySelectorAll(\"img[srcset]\").forEach(rewriteURLSrcSet(\"srcset\", base));\n    el.querySelectorAll(\"blockquote[cite]\").forEach(rewriteURL(\"cite\", base));\n    el.querySelectorAll(\"del[cite]\").forEach(rewriteURL(\"cite\", base));\n    el.querySelectorAll(\"ins[cite]\").forEach(rewriteURL(\"cite\", base));\n    el.querySelectorAll(\"q[cite]\").forEach(rewriteURL(\"cite\", base));\n    el.querySelectorAll(\"img[longdesc]\").forEach(rewriteURL(\"longdesc\", base));\n    el.querySelectorAll(\"frame[longdesc]\").forEach(rewriteURL(\"longdesc\", base));\n    el.querySelectorAll(\"iframe[longdesc]\").forEach(rewriteURL(\"longdesc\", base));\n    el.querySelectorAll(\"img[usemap]\").forEach(rewriteURL(\"usemap\", base));\n    el.querySelectorAll(\"input[usemap]\").forEach(rewriteURL(\"usemap\", base));\n    el.querySelectorAll(\"object[usemap]\").forEach(rewriteURL(\"usemap\", base));\n    el.querySelectorAll(\"form[action]\").forEach(rewriteURL(\"action\", base));\n    el.querySelectorAll(\"button[formaction]\").forEach(rewriteURL(\"formaction\", base));\n    el.querySelectorAll(\"input[formaction]\").forEach(rewriteURL(\"formaction\", base));\n    el.querySelectorAll(\"video[poster]\").forEach(rewriteURL(\"poster\", base));\n    el.querySelectorAll(\"object[data]\").forEach(rewriteURL(\"data\", base));\n    el.querySelectorAll(\"object[codebase]\").forEach(rewriteURL(\"codebase\", base));\n    el.querySelectorAll(\"object[archive]\").forEach(rewriteURLList(\"archive\", base));\n    /* el.querySelectorAll(\"command[icon]\").forEach(this.rewriteURL(\"icon\")); */ // obsolte\n  });\n}\n\nfunction rewriteURL(attr: string, base: string) {\n  return (el: Element) => {\n    try {\n      const attrVal = el.getAttribute(attr);\n      if (attrVal == null) return;\n      el.setAttribute(attr, new URL(attrVal, base).href);\n    } catch (e) {\n      // if (process.env.DEBUG) console.warn(`Couldn't rewrite URL in attribute ${attr} on element`, el);\n    }\n  };\n}\n\nfunction rewriteURLSrcSet(attr: string, base: string) {\n  return (el: Element) => {\n    try {\n      const attrVal = el.getAttribute(attr);\n      if (attrVal == null) return;\n      el.setAttribute(\n        attr,\n        attrVal\n          .split(/\\s*,\\s*/)\n          .map(str => {\n            const pair = str.split(/\\s+/);\n            pair[0] = new URL(pair[0], base).href;\n            return pair.join(\" \");\n          })\n          .join(\", \")\n      );\n    } catch (e) {\n      // if (process.env.DEBUG) console.warn(`Couldn't rewrite URLs in attribute ${attr} on element`, el);\n    }\n  };\n}\n\nfunction rewriteURLList(attr: string, base: string) {\n  return (el: Element) => {\n    try {\n      const attrVal = el.getAttribute(attr);\n      if (attrVal == null) return;\n      el.setAttribute(\n        attr,\n        attrVal\n          .split(/[\\s,]+/)\n          .map(str => new URL(str, base).href)\n          .join(\", \")\n      );\n    } catch (e) {\n      // if (process.env.DEBUG) console.warn(`Couldn't rewrite URLs in attribute ${attr} on element`, el);\n    }\n  };\n}","import { of, from } from \"rxjs\";\nimport { concatMap, catchError, finalize, mapTo } from \"rxjs/operators\";\n\nimport { HyPushState } from \".\";\n\nfunction cloneScript(script: HTMLScriptElement) {\n  const newScript = document.createElement('script');\n  Array.from(script.attributes).forEach(attr => newScript.setAttributeNode(attr.cloneNode() as Attr));\n  newScript.innerHTML = script.innerHTML;\n  return newScript;\n}\n\nexport class ScriptManager {\n  private parent: HyPushState;\n\n  constructor(parent: HyPushState) {\n    this.parent = parent;\n  }\n\n  get scriptSelector() { return this.parent.scriptSelector }\n\n  removeScriptTags(replaceEls: (Element|null)[]) {\n    const scripts: Array<[HTMLScriptElement, HTMLScriptElement]> = [];\n\n    replaceEls.forEach(el => {\n      if (el && this.scriptSelector) {\n        el.querySelectorAll(this.scriptSelector).forEach((script) => {\n          if (script instanceof HTMLScriptElement) {\n            const newScript = cloneScript(script);\n            const pair: [HTMLScriptElement, HTMLScriptElement] = [newScript, script];\n            scripts.push(pair);\n          }\n        });\n      }\n    });\n\n    return scripts;\n  }\n\n  reinsertScriptTags(context: { scripts: Array<[HTMLScriptElement, HTMLScriptElement]> }) {\n    if (!this.scriptSelector) return Promise.resolve(context);\n\n    const { scripts } = context;\n\n    const originalWrite = document.write;\n\n    return from(scripts).pipe(\n      concatMap(script => this.insertScript(script)),\n      catchError(error => of({ ...context, error })),\n      finalize(() => (document.write = originalWrite)),\n      mapTo(context),\n    )\n      .toPromise();\n  }\n\n  private insertScript([script, ref]: [HTMLScriptElement, HTMLScriptElement]): Promise<{}> {\n    document.write = (...args) => {\n      const temp = document.createElement(\"div\");\n      temp.innerHTML = args.join();\n      Array.from(temp.childNodes).forEach(node => ref.parentNode?.insertBefore(node, ref));\n    };\n\n    return new Promise((resolve, reject) => {\n      if (script.src !== \"\") {\n        script.addEventListener(\"load\", resolve);\n        script.addEventListener(\"error\", reject);\n        ref.parentNode?.replaceChild(script, ref);\n      } else {\n        ref.parentNode?.replaceChild(script, ref);\n        resolve({});\n      }\n    });\n  }\n}","import { getScrollTop, Cause } from \"./common\";\n\ninterface ScrollState {\n  [k: string]: any;\n  scrollTop?: number;\n  scrollHeight?: number;\n}\n\nexport class ScrollManager {\n  private parent: { histId: string } & HTMLElement;\n\n  constructor(parent: { histId: string } & HTMLElement) {\n    this.parent = parent;\n    if ('scrollRestoration' in history) {\n      history.scrollRestoration = 'manual';\n    }\n  }\n\n  manageScrollPosition({ cause, url: { hash } }: { cause: Cause, url: URL }) {\n    switch (cause) {\n      case Cause.Push: {\n        // FIXME: make configurable\n        this.scrollHashIntoView(hash, { behavior: \"smooth\", block: \"start\", inline: \"nearest\" });\n        break;\n      }\n      case Cause.Pop: {\n        this.restoreScrollPosition();\n        break;\n      }\n      case Cause.Init: {\n        this.restoreScrollPositionOnReload();\n        break;\n      }\n    }\n  }\n\n  private elementFromHash(hash: string) {\n    return document.getElementById(decodeURIComponent(hash.substr(1)))\n  }\n\n  private scrollHashIntoView(hash: string, options: boolean | ScrollIntoViewOptions) {\n    if (hash) {\n      const el = this.elementFromHash(hash);\n      if (el) el.scrollIntoView(options);\n    } else {\n      window.scroll(window.pageXOffset, 0);\n    }\n  }\n\n  private restoreScrollPosition() {\n    const { histId } = this.parent;\n    const { scrollTop } = (history.state && history.state[histId]) || {} as ScrollState;\n\n    if (scrollTop != null) {\n      window.scroll(window.pageXOffset, scrollTop);\n    }\n  }\n\n  private restoreScrollPositionOnReload() {\n    const { histId } = this.parent;\n    const scrollState = history.state && history.state[histId];\n    // FIXME: As far as I can tell there is no better way of figuring out if the user has scrolled\n    //        and it doesn't work on hash links b/c the scroll position is going to be non-null by definition\n    if (scrollState && getScrollTop() === 0) {\n      this.restoreScrollPosition();\n    } else if (location.hash) {\n      requestAnimationFrame(() => this.scrollHashIntoView(location.hash, true));\n    }\n  }\n};\n","import { isExternal, fragmentFromString } from \"./common\";\n\nimport { ScriptManager } from \"./script\";\nimport { rewriteURLs } from \"./rewrite-urls\";\n\nimport { ResponseContext, ResponseContextOk } from './fetch';\nimport { HyPushState } from \".\";\n\nconst CANONICAL_SEL = 'link[rel=canonical]';\nconst META_DESC_SEL = 'meta[name=description]';\n\nexport interface ReplaceContext extends ResponseContext {\n  title: string;\n  document: Document,\n  replaceEls: (Element | null)[];\n  scripts: Array<[HTMLScriptElement, HTMLScriptElement]>;\n};\n\nexport class UpdateManager {\n  private parent!: HyPushState;\n  private scriptManager!: ScriptManager;\n\n  constructor(parent: HyPushState) {\n    this.parent = parent;\n    this.scriptManager = new ScriptManager(parent);\n  }\n\n  get el() { return this.parent; }\n  get replaceSelector() { return this.parent.replaceSelector; }\n  get scriptSelector() { return this.parent.scriptSelector; }\n\n  // Extracts the elements to be replaced\n  private getReplaceElements(doc: Document): (Element | null)[] {\n    if (this.replaceSelector) {\n      return this.replaceSelector.split(',').map(sel => doc.querySelector(sel));\n    } else if (this.el.id) {\n      return [doc.getElementById(this.el.id)];\n    } else {\n      const index = Array.from(document.getElementsByTagName(this.el.tagName)).indexOf(this.el);\n      return [doc.getElementsByTagName(this.el.tagName)[index]];\n    }\n  }\n\n  // Takes the response string and turns it into document fragments\n  // that can be inserted into the DOM.\n  responseToContent(context: ResponseContextOk): ReplaceContext {\n    const { responseText } = context;\n\n    const doc = new DOMParser().parseFromString(responseText, 'text/html');\n    const { title = '' } = doc;\n    const replaceEls = this.getReplaceElements(doc);\n\n    if (replaceEls.every(el => el == null)) {\n      throw new Error(`Couldn't find any element in the document at '${location}'.`);\n    }\n\n    const scripts = this.scriptSelector\n      ? this.scriptManager.removeScriptTags(replaceEls)\n      : [];\n\n    return { ...context, document: doc, title, replaceEls, scripts };\n  }\n\n  // Replaces the old elements with the new one, one-by-one.\n  private replaceContentWithSelector(replaceSelector: string, elements: (Element | null)[]) {\n    replaceSelector\n      .split(',')\n      .map(sel => document.querySelector(sel))\n      .forEach((oldElement, i) => {\n        const el = elements[i];\n        if (el) oldElement?.parentNode?.replaceChild(el, oldElement);\n      });\n  }\n\n  // When no `replaceIds` are set, replace the entire content of the component (slow).\n  private replaceContentWholesale([el]: (Element | null)[]) {\n    if (el) this.el.innerHTML = el.innerHTML;\n  }\n\n  private replaceContent(replaceEls: (Element | null)[]) {\n    if (this.replaceSelector) {\n      this.replaceContentWithSelector(this.replaceSelector, replaceEls);\n    } else {\n      this.replaceContentWholesale(replaceEls);\n    }\n  }\n\n  private replaceHead(doc: Document)  {\n    const { head } = this.el.ownerDocument;\n\n    const canonicalEl = head.querySelector(CANONICAL_SEL) as HTMLLinkElement|null;\n    const cEl = doc.head.querySelector(CANONICAL_SEL) as HTMLLinkElement|null;\n    if (canonicalEl && cEl) canonicalEl.href = cEl.href;\n\n    const metaDescEl = head.querySelector(META_DESC_SEL) as HTMLMetaElement|null;\n    const mEl = doc.head.querySelector(META_DESC_SEL) as HTMLMetaElement|null;\n    if (metaDescEl && mEl) metaDescEl.content = mEl.content;\n  }\n\n  updateDOM(context: ReplaceContext) {\n    try {\n      const { replaceEls, document } = context;\n      if (isExternal(this.parent)) rewriteURLs(replaceEls, this.parent.href);\n      this.replaceHead(document)\n      this.replaceContent(replaceEls);\n    } catch (error) {\n      throw { ...context, error };\n    }\n  }\n\n  reinsertScriptTags(context: { scripts: Array<[HTMLScriptElement, HTMLScriptElement]> }) {\n    return this.scriptManager.reinsertScriptTags(context);\n  }\n}\n"],"sourceRoot":""}